# Руководство по настройке Godot MCP для работы в WSL

Этот гайд объясняет, как настроить окружение для подключения к запущенному в Windows редактору Godot из инструментов, работающих внутри WSL (например, Gemini CLI).

Существует два основных способа взаимодействия с Godot, и для полноценной работы может потребоваться настройка обоих.

---

## Раздел 1: Установка Gemini CLI

Это основной инструмент для взаимодействия с Godot из командной строки.

1.  Убедитесь, что у вас установлен Node.js и npm.
2.  Откройте терминал (PowerShell, cmd или WSL) и выполните команду:
    ```bash
    npm install -g @google/gemini-cli
    ```

---

## Раздел 2: Подключение к редактору (WebSocket-метод)

Этот метод необходим для работы **встроенных инструментов Godot** в Gemini, таких как `list_nodes`, `create_node`, `get_node_properties` и т.д. Он использует WebSocket для прямого подключения к плагину внутри запущенного редактора Godot.

### Шаг 2.1: Установка `socat` в WSL

`socat` — это утилита, которая будет выполнять переадресацию портов из WSL в Windows.

Откройте терминал WSL и установите ее:
```bash
sudo apt-get update && sudo apt-get install -y socat
```

### Шаг 2.2: Настройка автоматической переадресации портов в WSL

Чтобы не запускать переадресацию вручную каждый раз, добавим команду в автозагрузку вашей командной оболочки в WSL.

1.  **Откройте конфигурационный файл вашей оболочки.**
    *   Если вы используете **zsh**: `nano ~/.zshrc`
    *   Если вы используете **bash**: `nano ~/.bashrc`

2.  **Добавьте следующий код в конец файла.**
    ```bash
    # Автоматический проброс порта для Godot MCP на хост Windows
    if ! pgrep -f "socat TCP-LISTEN:9080" > /dev/null;
        export WINDOWS_HOST_IP=$(cat /etc/resolv.conf | grep nameserver | awk '{print $2}' | head -n 1)
        socat TCP-LISTEN:9080,fork TCP:${WINDOWS_HOST_IP}:9080 &
    fi
    ```

3.  **Сохраните и закройте файл** (`Ctrl+X`, `Y`, `Enter`).

4.  **Перезапустите терминал WSL**, чтобы изменения вступили в силу.

### Шаг 2.3: Создание правила в брандмауэре Windows

Брандмауэр Windows блокирует подключения из WSL. Нужно создать правило, разрешающее трафик на порт `9080`.

1.  **Откройте PowerShell от имени администратора.**

2.  **Выполните следующую команду:**
    ```powershell
    New-NetFirewallRule -DisplayName "Godot MCP (WSL)" -Direction Inbound -Action Allow -Protocol TCP -LocalPort 9080
    ```

---

## Раздел 3: Настройка `settings.json` (stdio-метод)

Этот файл настраивает Gemini CLI для работы с кастомным MCP-сервером, который общается через `stdio`. Это может быть необходимо для специфичных или кастомных инструментов.

1.  В корневой папке вашего проекта создайте папку `.gemini`, если ее нет.
2.  Внутри `.gemini` создайте файл `settings.json`.
3.  Добавьте в него следующее содержимое:

    ```json
    {
        "mcpServers": {
            "godot": {
                "command": "node",
                "args": [
                    "D:\\Project\\Soft\\MCP\\godot-mcp\\build\\index.js"
                ],
                "env": {
                    "GODOT_PATH": "C:\\Program Files\\Godot\\Godot_v4.5-stable_win64.exe"
                }
            },
            "godot-mcp": {
                "command": "node",
                "args": [
                    "/home/projects/MCP/godot-mcp/server/dist/index.js"
                ],
                "env": {
                    "MCP_TRANSPORT": "stdio"
                }
            }
        }
    }
    ```

> **ВАЖНО:** Пути в этом файле (`D:\Project\...`, `/home/projects/...`) могут быть специфичны для компьютера первоначального разработчика. Вам может потребоваться адаптировать их под вашу собственную структуру папок.

---

## Раздел 4: Активация плагина в Godot

Наконец, убедитесь, что сам плагин `godot-mcp` включен в редакторе Godot.

1.  Откройте ваш проект в Godot.
2.  Перейдите в `Проект -> Настройки проекта...`
3.  Откройте вкладку `Плагины`.
4.  Убедитесь, что напротив `godot-mcp` стоит галочка `Включен`.